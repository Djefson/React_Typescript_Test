"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Button = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactFela = require("react-fela");

var _click = require("../click");

var _block = require("../block");

var _inline = require("../inline");

var _spinner = require("../spinner");

var _getThemeStyle = require("../../get-theme-style");

var _sizeToRem = require("../../size-to-rem");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var padding = function padding(x, y) {
  return {
    padding: "".concat(x, "px ").concat(y, "px")
  };
};

var getIntentStyleMap = function getIntentStyleMap(_ref) {
  var tokens = _ref.tokens;
  return {
    primary: {
      color: tokens.buttonPrimaryColor,
      defaultForeground: tokens.buttonPrimaryForeground,
      highlight: tokens.buttonPrimaryHoverBackground,
      activeBackground: tokens.buttonPrimaryActiveBackground,
      outlineColor: tokens.buttonPrimaryOutlineColor
    },
    secondary: {
      color: tokens.buttonSecondaryColor,
      defaultForeground: tokens.buttonSecondaryForeground,
      highlight: tokens.buttonSecondaryHoverBackground,
      activeBackground: tokens.buttonSecondaryActiveBackground
    },
    destructive: {
      color: tokens.buttonDestructiveColor,
      defaultForeground: tokens.buttonDestructiveForeground,
      highlight: tokens.buttonDestructiveHoverBackground,
      activeBackground: tokens.buttonDestructiveActiveBackground
    }
  };
};

var button = function button(_ref2) {
  var disabled = _ref2.disabled,
      intent = _ref2.intent,
      variant = _ref2.variant,
      size = _ref2.size,
      loading = _ref2.loading,
      theme = _ref2.theme;
  var intentStyleMap = getIntentStyleMap(theme);

  var _ref3 = intentStyleMap[intent] || intentStyleMap.primary,
      color = _ref3.color,
      outlineColor = _ref3.outlineColor,
      defaultForeground = _ref3.defaultForeground,
      activeBackground = _ref3.activeBackground,
      highlight = _ref3.highlight;

  return _objectSpread(_objectSpread({
    display: 'inline-flex',
    minWidth: 96,
    width: '100%',
    outline: 0,
    whiteSpace: 'nowrap',
    justifyContent: 'center',
    userSelect: 'none',
    WebkitTouchCallout: 'none',
    alignItems: 'baseline'
  }, padding(theme.tokens.buttonPaddingVertical, theme.tokens.buttonPaddingHorizontal)), {}, {
    fontFamily: theme.fontTypes.NOVUM,
    textAlign: 'center',
    fontSize: (0, _sizeToRem.sizeToRem)(1.75),
    textTransform: 'uppercase',
    lineHeight: '22px',
    transitionDuration: disabled ? 0 : '100ms, 300ms',
    transitionTimingFunction: 'ease-out',
    transitionProperty: 'transform, background, fill, stroke, color, border-color',
    borderColor: 'transparent',
    borderStyle: 'solid',
    borderWidth: 1,
    borderRadius: 4,
    fontWeight: 500,
    letterSpacing: '0.02em',
    ':focus': {
      boxShadow: "0 0 0 2px ".concat(highlight, "33"),
      ':active': {
        background: activeBackground
      }
    },
    ':focus:not(:focus-visible)': {
      boxShadow: 'none'
    },
    extend: [{
      condition: size === 'small',
      style: _objectSpread(_objectSpread({
        fontSize: (0, _sizeToRem.sizeToRem)(1.5),
        lineHeight: '20px'
      }, padding(theme.tokens.buttonPaddingVertical - theme.baselineGrid / 2 + 1, theme.tokens.buttonPaddingHorizontal - theme.baselineGrid)), {}, {
        '> div svg': {
          height: theme.baselineGrid * 3,
          width: theme.baselineGrid * 3
        }
      })
    }, {
      condition: size === 'large',
      style: _objectSpread(_objectSpread({
        fontSize: (0, _sizeToRem.sizeToRem)(2),
        lineHeight: '24px'
      }, padding(theme.tokens.buttonPaddingVertical * 2 - 1, theme.tokens.buttonPaddingHorizontal + theme.baselineGrid * 2)), {}, {
        '> div svg': {
          height: theme.baselineGrid * 5,
          width: theme.baselineGrid * 5
        }
      })
    }, {
      condition: loading,
      style: {
        justifyContent: 'center',
        alignItems: 'center',
        pointerEvents: 'none'
      }
    }, {
      condition: !disabled,
      style: {
        '@media (hover: hover)': {
          extend: [{
            condition: variant === 'default',
            style: {
              ':hover': {
                borderColor: highlight,
                background: highlight
              }
            }
          }, {
            condition: variant === 'outline',
            style: {
              ':hover': {
                background: color,
                color: defaultForeground,
                borderColor: color,
                fill: defaultForeground,
                stroke: defaultForeground
              }
            }
          }, {
            condition: variant === 'text',
            style: {
              ':hover': {
                color: highlight
              }
            }
          }]
        },
        ':active': {
          extend: [{
            transform: 'scale(0.95, 0.9)'
          }, {
            condition: variant === 'default',
            style: {
              borderColor: highlight,
              background: highlight
            }
          }, {
            condition: variant === 'outline',
            style: {
              background: color,
              color: defaultForeground,
              borderColor: color,
              fill: defaultForeground,
              stroke: defaultForeground
            }
          }, {
            condition: variant === 'text',
            style: {
              color: highlight
            }
          }]
        },
        extend: [{
          condition: variant === 'default',
          style: {
            borderColor: color,
            background: color,
            color: defaultForeground,
            fill: defaultForeground,
            stroke: defaultForeground
          }
        }, {
          condition: variant === 'outline',
          style: {
            borderColor: outlineColor || color,
            color: outlineColor || color,
            fill: outlineColor || color,
            stroke: outlineColor || color
          }
        }, {
          condition: variant === 'text',
          style: {
            borderColor: 'transparent',
            fill: color,
            color: color,
            stroke: color
          }
        }]
      }
    }, {
      condition: disabled,
      style: {
        opacity: 0.3,
        cursor: 'default',
        fill: theme.color.foreground.secondary,
        stroke: theme.color.foreground.secondary,
        ':focus': {
          outline: '0 0 0 2px #CCCCCC33'
        },
        ':focus:not(:focus-visible)': {
          outline: 0
        },
        extend: [{
          condition: variant === 'default',
          style: {
            background: color,
            color: defaultForeground
          }
        }, {
          condition: variant === 'outline',
          style: {
            borderColor: color,
            color: color
          }
        }]
      }
    }]
  });
};

var Button = /*#__PURE__*/_react.default.forwardRef(function (_ref4, ref) {
  var children = _ref4.children,
      loading = _ref4.loading,
      disabled = _ref4.disabled,
      _ref4$intent = _ref4.intent,
      intent = _ref4$intent === void 0 ? 'primary' : _ref4$intent,
      _ref4$variant = _ref4.variant,
      variant = _ref4$variant === void 0 ? 'default' : _ref4$variant,
      _ref4$size = _ref4.size,
      size = _ref4$size === void 0 ? 'medium' : _ref4$size,
      props = (0, _objectWithoutProperties2.default)(_ref4, ["children", "loading", "disabled", "intent", "variant", "size"]);

  var _useFela = (0, _reactFela.useFela)(),
      theme = _useFela.theme;

  var styleProps = {
    disabled: disabled,
    intent: intent,
    variant: variant,
    loading: loading,
    size: size,
    theme: theme
  };
  return /*#__PURE__*/_react.default.createElement(_block.Block, {
    extend: {
      width: '100%'
    }
  }, /*#__PURE__*/_react.default.createElement(_click.Click, (0, _extends2.default)({
    ref: ref
  }, props, {
    onTouchStart: function onTouchStart() {},
    disabled: disabled || loading,
    extend: [button(styleProps), (0, _getThemeStyle.getThemeStyle)('button', theme, styleProps)]
  }), loading && /*#__PURE__*/_react.default.createElement(_block.Block, {
    extend: {
      position: 'absolute',
      margin: '0 auto'
    }
  }, /*#__PURE__*/_react.default.createElement(_spinner.Spinner, {
    color: "inherit",
    size: theme.baselineGrid * 3
  })), loading ? /*#__PURE__*/_react.default.createElement(_inline.Inline, {
    extend: {
      visibility: 'hidden'
    }
  }, /*#__PURE__*/_react.default.createElement(InnerButton, null, children)) : /*#__PURE__*/_react.default.createElement(InnerButton, null, children)));
});

exports.Button = Button;

var InnerButton = function InnerButton(_ref5) {
  var children = _ref5.children;
  return /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, children);
};

Button.displayName = 'Button';
Button.propTypes = {
  /** A JSX node */
  children: _propTypes.default.node,
  intent: _propTypes.default.oneOf(['primary', 'secondary', 'destructive']),
  variant: _propTypes.default.oneOf(['default', 'outline', 'text']),
  loading: _propTypes.default.bool,
  disabled: _propTypes.default.bool,

  /** Adding href changes the HTML element from `<button>` to `<a>` */
  href: _propTypes.default.string,
  size: _propTypes.default.oneOf(['small', 'medium', 'large'])
};